<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cetusMobigenDataset">

    <select id="getAllMobigenDatasetList" resultType="MobigenDatasetList" parameterType="SearchMobigenDataset">
        /* cetusMobigenDataset.getAllMobigenDatasetList */
        SELECT CMD.UID
              ,CMD.TITLE
              ,TO_CHAR(CMD.REG_DT, 'YYYY-MM-DD HH:MM') AS REG_DT
          FROM CETUS_MOBIGEN_DATASET CMD
         WHERE CMD.DELETE_AT = 'N'
         ORDER BY CMD.REG_DT DESC
    </select>

    <insert id="insert" parameterType="CetusMobigenDataset" useGeneratedKeys="true" keyProperty="uid">
        /* cetusMobigenDataset.insert */
        INSERT INTO CETUS_MOBIGEN_DATASET (
             TITLE
            ,REG_DT
            ,DELETE_AT
            ,METADATA
        ) VALUES (
             #{title}
            ,NOW()
            ,'N'
            ,#{metadata}::jsonb
        )
    </insert>

    <update id="deleteMobigenDataset" parameterType="CetusMobigenDataset">
        /* cetusMobigenDataset.deleteMobigenDataset */
        UPDATE CETUS_MOBIGEN_DATASET
           SET DELETE_AT = 'Y'
         WHERE UID = #{uid}
    </update>

    <select id="getMobigenDatasetByDatasetId" parameterType="Long" resultType="MobigenDatasetView">
        /* cetusMobigenDataset.getMobigenDatasetByDatasetId */
        SELECT CMD.UID AS DATASET_ID
              ,CMD.TITLE
              ,TO_CHAR(CMD.REG_DT, 'YYYY-MM-DD HH:MM') AS REG_DT
              ,CMD.METADATA
          FROM CETUS_MOBIGEN_DATASET CMD
         WHERE CMD.UID = #{uid}
    </select>

    <update id="update" parameterType="CetusMobigenDataset">
        /* cetusMobigenDataset.update */
        UPDATE CETUS_MOBIGEN_DATASET
           SET TITLE = #{title}
              ,METADATA = #{metadata}::jsonb
         WHERE UID = #{uid}
    </update>

    <update id="ifExistDeleteApprovedDataset" parameterType="Long">
        /* cetusApprovedDataset.ifExistDeleteApprovedDataset */
        UPDATE CETUS_APPROVED_DATASET
           SET DELETE_AT = 'Y'
         WHERE DATASET_ID = #{datasetId}
    </update>

</mapper>