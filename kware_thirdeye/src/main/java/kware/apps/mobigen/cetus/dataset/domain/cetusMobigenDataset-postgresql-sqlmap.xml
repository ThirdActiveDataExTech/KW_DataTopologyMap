<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cetusMobigenDataset">

    <select id="getAllMobigenDatasetList" resultType="MobigenDatasetList" parameterType="SearchMobigenDataset">
        /* cetusMobigenDataset.getAllMobigenDatasetList */
        SELECT CMD.UID
              ,CMD.TITLE
              ,TO_CHAR(CMD.REG_DT, 'YYYY-MM-DD HH:MM') AS REG_DT
          FROM CETUS_MOBIGEN_DATASET CMD
         WHERE CMD.DELETE_AT = 'N'
         ORDER BY CMD.REG_DT DESC
    </select>

    <insert id="insert" parameterType="CetusMobigenDataset" useGeneratedKeys="true" keyProperty="uid">
        /* cetusMobigenDataset.insert */
        INSERT INTO CETUS_MOBIGEN_DATASET (
             TITLE
            ,METADATA_FILE_UID
            ,REALDATA_FILE_UID
            ,REG_DT
            ,DELETE_AT
            ,METADATA
        ) VALUES (
             #{title}
            ,#{metadataFileUid}::int8
            ,#{realdataFileUid}::int8
            ,NOW()
            ,'N'
            ,#{metadata}::jsonb
        )
    </insert>

    <update id="deleteMobigenDataset" parameterType="CetusMobigenDataset">
        /* cetusMobigenDataset.deleteMobigenDataset */
        UPDATE CETUS_MOBIGEN_DATASET
           SET DELETE_AT = 'Y'
         WHERE UID = #{uid}
    </update>

    <select id="getMobigenDatasetByDatasetId" parameterType="Long" resultType="MobigenDatasetView">
        /* cetusMobigenDataset.getMobigenDatasetByDatasetId */
        SELECT CMD.UID AS DATASET_ID
              ,CMD.TITLE
              ,TO_CHAR(CMD.REG_DT, 'YYYY-MM-DD HH:MM') AS REG_DT
              ,CMD.METADATA_FILE_UID
              ,CMD.REALDATA_FILE_UID
              ,CMD.METADATA
          FROM CETUS_MOBIGEN_DATASET CMD
         WHERE CMD.UID = #{uid}
    </select>

    <update id="update" parameterType="CetusMobigenDataset">
        /* cetusMobigenDataset.update */
        UPDATE CETUS_MOBIGEN_DATASET
           SET TITLE = #{title}
              ,REALDATA_FILE_UID = #{realdataFileUid}::int8
              ,METADATA = #{metadata}::jsonb
         WHERE UID = #{uid}
    </update>

    <select id="getRealDataInfoByFileId" parameterType="String" resultType="MobigenDatasetRealDataView">
        /* cetusMobigenDataset.getRealDataInfoByFileId */
        SELECT CF.FILE_ID AS FILE_ID
              ,CF.ORG_FILE_NM AS ORG_FILE_NM
              ,CF.FILE_PATH AS FILE_PATH
              ,CF.FILE_SIZE AS FILE_SIZE
              ,CF.FILE_TYPE AS FILE_TYPE
              ,CF.EXTENSION AS EXTENSION
              ,CF.DOWN_CNT AS DOWN_CNT
              ,TO_CHAR(CF.REG_DT, 'YYYY-MM-DD HH:MM') AS REG_DT
          FROM CETUS_FILE CF
         WHERE CF.FILE_ID = #{fileId}
    </select>

    <update id="ifExistDeleteApprovedDataset" parameterType="DeleteApprovedDatasetIfExist">
        /* cetusApprovedDataset.ifExistDeleteApprovedDataset */
        UPDATE CETUS_APPROVED_DATASET
           SET DELETE_AT = 'Y'
         WHERE WORKPLACE_UID = #{workplaceUid}
           AND DATASET_ID = #{datasetId}
    </update>

</mapper>