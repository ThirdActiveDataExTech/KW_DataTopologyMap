<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cetusMobigenDataset">

    <select id="getAllMobigenDatasetList" resultType="MetadataResultResponse" parameterType="SearchMobigenDataset">
        /* cetusMobigenDataset.getAllMobigenDatasetList */
        SELECT CMD.UID
              ,CMD.TITLE
              ,TO_CHAR(CMD.REG_DT, 'YYYY-MM-DD HH:MM') AS REG_DT
          FROM CETUS_MOBIGEN_DATASET CMD
         WHERE CMD.DELETE_AT = 'N'
         ORDER BY CMD.REG_DT DESC
         OFFSET #{offset} LIMIT #{limit}
    </select>
    <select id="getAllMobigenDatasetListCount" resultType="int">
        /* cetusMobigenDataset.getAllMobigenDatasetListCount */
        SELECT COUNT(*)
          FROM CETUS_MOBIGEN_DATASET CMD
         WHERE CMD.DELETE_AT = 'N'
    </select>



    <select id="getAllRelationMobigenDatasetList" resultType="RelatedMetadataResponse" parameterType="SearchMobigenDataset">
        /* cetusMobigenDataset.getAllRelationMobigenDatasetList */
        SELECT CMD.UID
              ,CMD.TITLE
              ,TO_CHAR(CMD.REG_DT, 'YYYY-MM-DD HH:MM') AS REG_DT
          FROM CETUS_MOBIGEN_DATASET CMD
         WHERE CMD.DELETE_AT = 'N'
         ORDER BY CMD.REG_DT DESC
         OFFSET #{offset} LIMIT #{limit}
    </select>
    <select id="getAllRelationMobigenDatasetListCount" resultType="int">
        /* cetusMobigenDataset.getAllRelationMobigenDatasetListCount */
        SELECT COUNT(*)
          FROM CETUS_MOBIGEN_DATASET CMD
         WHERE CMD.DELETE_AT = 'N'
    </select>



    <select id="getAllRecommendationMobigenDatasetList" resultType="RecommendationsResponse" parameterType="SearchMobigenDataset">
        /* cetusMobigenDataset.getAllRecommendationMobigenDatasetList */
        SELECT CMD.UID
              ,CMD.TITLE
              ,TO_CHAR(CMD.REG_DT, 'YYYY-MM-DD HH:MM') AS REG_DT
          FROM CETUS_MOBIGEN_DATASET CMD
         WHERE CMD.DELETE_AT = 'N'
         ORDER BY CMD.REG_DT DESC
         OFFSET #{offset} LIMIT #{limit}
    </select>
    <select id="getAllRecommendationMobigenDatasetListCount" resultType="int">
        /* cetusMobigenDataset.getAllRecommendationMobigenDatasetListCount */
        SELECT COUNT(*)
          FROM CETUS_MOBIGEN_DATASET CMD
         WHERE CMD.DELETE_AT = 'N'
    </select>




    <insert id="insert" parameterType="CetusMobigenDataset" useGeneratedKeys="true" keyProperty="uid">
        /* cetusMobigenDataset.insert */
        INSERT INTO CETUS_MOBIGEN_DATASET (
             TITLE
            ,REG_DT
            ,DELETE_AT
            ,EXTDATA
        ) VALUES (
             #{title}
            ,NOW()
            ,'N'
            ,#{extdata}::jsonb
        )
    </insert>

    <update id="deleteMobigenDataset" parameterType="CetusMobigenDataset">
        /* cetusMobigenDataset.deleteMobigenDataset */
        UPDATE CETUS_MOBIGEN_DATASET
           SET DELETE_AT = 'Y'
         WHERE UID = #{uid}
    </update>

    <select id="getMobigenDatasetByMetadataId" parameterType="Long" resultType="MetadataView">
        /* cetusMobigenDataset.getMobigenDatasetByMetadataId */
        SELECT CMD.UID AS METADATA_ID
              ,CMD.TITLE
              ,TO_CHAR(CMD.REG_DT, 'YYYY-MM-DD HH:MM') AS REG_DT
              ,CMD.EXTDATA
          FROM CETUS_MOBIGEN_DATASET CMD
         WHERE CMD.UID = #{metadataId}
    </select>

    <update id="update" parameterType="CetusMobigenDataset">
        /* cetusMobigenDataset.update */
        UPDATE CETUS_MOBIGEN_DATASET
           SET TITLE = #{title}
              ,EXTDATA = #{extdata}::jsonb
         WHERE UID = #{uid}
    </update>

    <update id="ifExistDeleteApprovedDataset" parameterType="String">
        /* cetusApprovedDataset.ifExistDeleteApprovedDataset */
        UPDATE CETUS_APPROVED_DATASET
           SET DELETE_AT = 'Y'
         WHERE METADATA_ID = #{metadataId}
    </update>

</mapper>