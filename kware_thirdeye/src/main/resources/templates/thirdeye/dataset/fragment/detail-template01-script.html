<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<script th:inline="javascript">

    var template01JS = {

        drawTab01: function (dataset) {
            template01JS.setSubTabSampleVisualization();
            template01JS.setDataTable(dataset);
        },

        setDataTable: function (dataset) {

            console.log(">> dataset ", dataset);
            const jsonObj = JSON.parse(dataset['metadata']);
            console.log("jsonObj: ", jsonObj)

            const $tableBody = $('#tab1-table tbody');
            $tableBody.empty(); // 기존 내용 제거
            const itemsPerRow = 2;

            // jsonObj => key-value 배열로 변환
            function flattenObj(obj) {
                const result = [];
                for (const key in obj) {
                    if (obj.hasOwnProperty(key)) {
                        let value = obj[key];
                        if (Array.isArray(value)) {
                            value = value.join(', ');
                        } else if (typeof value === 'object' && value !== null) {
                            value = JSON.stringify(value); // 객체는 문자열로 변환
                        }
                        result.push({ key, value });
                    }
                }
                return result;
            }
            const entries = flattenObj(jsonObj);
            const totalItems = entries.length;
            const totalRows = Math.ceil(totalItems / itemsPerRow);
            for (let i = 0; i < totalRows; i++) {
                const row = $('<tr>');
                for (let j = 0; j < itemsPerRow; j++) {
                    const index = i * itemsPerRow + j;
                    if (index < totalItems) {
                        const item = entries[index];
                        row.append(`
                            <td class="col-2 width1">${item.key}</td>
                            <td class="col-4">${item.value}</td>
                        `);
                    }
                }
                $tableBody.append(row);
            }
        },

        setSubTabSampleVisualization : function(){
            const sampleData = {
                "dataList1" : [170.07, 164.74, 120.1, 105.83, 23.14, 24.84, 198.2, 85.34, 62.52, 114.19, 116.91, 75.84],
                "dataList2" : [1.44, 97.92, 79.27, 105.65, 168.2, 108.48, 126.39, 130.05, 205.69, 179.64, 119.06, 155.43]
            }
            template01JS.setEchartBar({
                rendarID : $("#searchTrendTimeZoneBoard").get(0),
                color1 : "#596fc0",
                color2 : "#9eca7f",
                dataList1 : sampleData.dataList1,
                dataList2 : sampleData.dataList2
            });
        },

        setEchartBar : function (argObj){
            var option = {
                tooltip: {},
                xAxis: {
                    data: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                    //name: 'Month',
                    axisLabel: {
                        interval: 0,
                        fontSize: 8
                    },
                    axisLine: { onZero: true },
                    splitLine: { show: false },
                    splitArea: { show: false }
                },
                yAxis: {
                    name: 'Data',
                    axisLabel: {
                        fontSize: 8
                    },
                    axisLine: { onZero: true },
                    splitLine: { show: true },
                    splitArea: { show: false }
                },
                grid: {
                    left: 30,
                    right: 30,
                    top: 40,
                    bottom: 70
                },
                dataZoom: [
                    {
                        type: 'inside',
                        start: 0,
                        end: '100%'
                    },
                    {
                        start: 0,
                        end: 20,
                        bottom: '5px'
                    }
                ],
                series: [
                    {
                        name: 'bar',
                        type: 'bar',
                        stack: 'one',
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowColor: argObj.color1
                            }
                        },
                        data: argObj.dataList1
                    },
                    {
                        name: 'bar2',
                        type: 'bar',
                        stack: 'two',
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowColor: argObj.color2
                            }
                        },
                        data: argObj.dataList2
                    }
                ]
            };

            template01JS.setDataToEchart(argObj.rendarID, option);
        },

        setDataToEchart : function(renderId, option){

            let myChart = echarts.init(renderId);
            myChart.hideLoading();
            option && myChart.setOption(option);

            $(window).resize(function() {
                myChart.resize();
            });
        },

    }

</script>
</html>
