<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:fragment="sidebar-menu(show)">
  <!-- Mobile Menu start -->
  <div class="off-canvas-active" th:data-show="${show}">
    <a class="off-canvas-close"><i class=" ti-close "></i></a>
    <div class="off-canvas-wrap">
      <div class="welcome-text off-canvas-margin-padding">
        <p>Default Welcome Msg! </p>
      </div>
      <div class="mobile-menu-wrap off-canvas-margin-padding-2">
        <div id="mobile-menu" class="slinky-mobile-menu text-left">
          <ul>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
  <!-- Mobile Menu end -->
  <script th:src="@{'/assets/js/vendor/jquery-3.6.0.min.js'}"></script>
  <script th:inline="javascript">

    const sidebarMenu = [[${user}]] ? [[${user?.menusTop}]] : []
  
  var mMenuObj = {

    createMenu: async function (targetEle) {
      const self = this; // `this` 참조 유지
      $.each(sidebarMenu, function (idx, val) {
        const topMenuEle = self.createMobileMenuElement(val); // `self`로 메서드 호출
        targetEle.append(topMenuEle);
      });
      mMenuObj.loadSlinkyStyle();
    },

    createMobileMenuElement: function (_menuObj) {

      const liEle = $("<li/>");
      const aEle = $("<a/>").text(_menuObj.menuNm);

      if (_menuObj.url) {

        aEle.attr("href", _menuObj.url)
                .addClass("menu-a-url")
                .attr("data-uid", _menuObj['uid']);
      }
      else{

        aEle.attr("href", "#");
      }

      liEle.append(aEle);

      // 하위 메뉴가 있는 경우
      if (_menuObj.children && Array.isArray(_menuObj.children) && _menuObj.children.length !== 0) {

        let ulEle = $("<ul/>");

        $.each(_menuObj.children, (idx, childrenObj) => {

          const subMenuEle = this.createMobileMenuElement(childrenObj);
          ulEle.append(subMenuEle);
        });

        liEle.append(ulEle);
      }

      return liEle;
    },

    // [TODO] 모바일 메뉴에 메뉴데이터를 동적으로 넣으면 시점차 때문에 정상동작이 안되서 main.js에 선언된 아래 로직을 재호출함(개선 필요)
    loadSlinkyStyle : function(){

      /*====== mobile-menu active ======*/
      const slinky = $('#mobile-menu').slinky();
      const slinky2 = $('#mobile-currency').slinky();
      const slinky3 = $('#mobile-language').slinky();

      /*====== off canvas active ======*/
      function mobileMainMenu() {
        var navbarTrigger = $('.mobile-menu-active-button'),
                endTrigger = $('.off-canvas-close'),
                container = $('.off-canvas-active'),
                wrapper = $('.main-wrapper-2');

        wrapper.prepend('<div class="body-overlay-2"></div>');

        navbarTrigger.on('click', function(e) {
          e.preventDefault();
          container.addClass('inside');
          wrapper.addClass('overlay-active-2');
        });

        endTrigger.on('click', function() {
          container.removeClass('inside');
          wrapper.removeClass('overlay-active-2');
        });

        $('.body-overlay-2').on('click', function() {
          container.removeClass('inside');
          wrapper.removeClass('overlay-active-2');
        });

        // 페이지 전환 후 간헐적으로 height가 0이 되는 버그 수정 .nckim 20250226
        if($('#mobile-menu').css("height") === 0 || $('#mobile-menu').css("height") === "0px"){

          $('#mobile-menu').css("height", "auto");
        }
      };
      mobileMainMenu();
    },
  };

  $(async function () {
    const dataMenuShow = $(".header-area").data('show')
    if (dataMenuShow === "Y") {
      let mobileMenuWrap = $("#mobile-menu ul");
      await mMenuObj.createMenu(mobileMenuWrap);
    }
  });

  </script>
</th:block>

</html>